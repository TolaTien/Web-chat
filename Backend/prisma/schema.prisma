generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model callhistory {
  call_id                              String                @id @db.Char(36)
  caller_id                            String                @db.Char(36)
  receiver_id                          String                @db.Char(36)
  call_type                            callhistory_call_type
  status                               callhistory_status?   @default(missed)
  start_time                           DateTime?             @default(now()) @db.DateTime(0)
  duration_seconds                     Int?                  @default(0)
  users_callhistory_caller_idTousers   users                 @relation("callhistory_caller_idTousers", fields: [caller_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "callhistory_ibfk_1")
  users_callhistory_receiver_idTousers users                 @relation("callhistory_receiver_idTousers", fields: [receiver_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "callhistory_ibfk_2")

  @@index([caller_id], map: "caller_id")
  @@index([receiver_id], map: "receiver_id")
}

model conversations {
  conversation_id                        String     @id @db.Char(36)
  user_one_id                            String     @db.Char(36)
  user_two_id                            String     @db.Char(36)
  last_message_content                   String?    @db.Text
  last_message_at                        DateTime?  @default(now()) @db.Timestamp(0)
  users_conversations_user_one_idTousers users      @relation("conversations_user_one_idTousers", fields: [user_one_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_one")
  users_conversations_user_two_idTousers users      @relation("conversations_user_two_idTousers", fields: [user_two_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_two")
  messages                               messages[]

  @@unique([user_one_id, user_two_id], map: "unique_user_pair")
  @@index([user_two_id], map: "fk_user_two")
}

model messages {
  message_id      String                 @id @db.Char(36)
  conversation_id String                 @db.Char(36)
  sender_id       String                 @db.Char(36)
  content         String?                @db.Text
  message_type    messages_message_type? @default(text)
  media_url       String?                @db.VarChar(255)
  created_at      DateTime?              @default(now()) @db.DateTime(0)
  is_read         Boolean?               @default(false)
  conversations   conversations          @relation(fields: [conversation_id], references: [conversation_id], onDelete: Cascade, onUpdate: NoAction, map: "messages_ibfk_1")
  users           users                  @relation(fields: [sender_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "messages_ibfk_2")

  @@index([conversation_id], map: "conversation_id")
  @@index([sender_id], map: "sender_id")
}

model users {
  user_id                                        String          @id @db.Char(36) 
  username                                       String          @unique(map: "username") @db.VarChar(50)
  email                                          String          @unique(map: "email") @db.VarChar(100)
  password                                       String          @db.VarChar(255)
  full_name                                      String?         @db.VarChar(100)
  avatar_url                                     String?         @db.VarChar(255)
  is_online                                      Boolean?        @default(false)
  created_at                                     DateTime?       @default(now()) @db.DateTime(0)
  callhistory_callhistory_caller_idTousers       callhistory[]   @relation("callhistory_caller_idTousers")
  callhistory_callhistory_receiver_idTousers     callhistory[]   @relation("callhistory_receiver_idTousers")
  conversations_conversations_user_one_idTousers conversations[] @relation("conversations_user_one_idTousers")
  conversations_conversations_user_two_idTousers conversations[] @relation("conversations_user_two_idTousers")
  messages                                       messages[]
}

enum callhistory_call_type {
  audio
  video
}

enum callhistory_status {
  missed
  completed
  rejected
  busy
}

enum messages_message_type {
  text
  image
  file
  call_log
}
